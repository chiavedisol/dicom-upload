// PostgreSQLç”¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
// ä½¿ç”¨æ–¹æ³•: node scripts/reset-migrations-postgresql.js

const fs = require('fs');
const path = require('path');

console.log('ğŸ”„ PostgreSQLç”¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™...\n');

const migrationsDir = path.join(process.cwd(), 'prisma', 'migrations');
const backupDir = path.join(process.cwd(), 'prisma', 'migrations_sqlite_backup');

// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
if (!fs.existsSync(backupDir)) {
  if (fs.existsSync(migrationsDir)) {
    console.log('ğŸ“¦ æ—¢å­˜ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­...');
    fs.renameSync(migrationsDir, backupDir);
    console.log(`âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: ${backupDir}\n`);
  }
}

// æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
if (!fs.existsSync(migrationsDir)) {
  fs.mkdirSync(migrationsDir, { recursive: true });
  console.log('âœ… æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã—ãŸ\n');
}

// migration_lock.tomlã‚’ä½œæˆ
const lockFile = path.join(migrationsDir, 'migration_lock.toml');
const lockContent = `# Please do not edit this file manually
# It should be added in your version-control system (i.e. Git)
provider = "postgresql"
`;

fs.writeFileSync(lockFile, lockContent);
console.log('âœ… migration_lock.tomlã‚’ä½œæˆã—ã¾ã—ãŸï¼ˆPostgreSQLç”¨ï¼‰\n');

console.log('ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:');
console.log('   1. npx prisma migrate dev --name init_postgresql');
console.log('   ã“ã‚Œã§PostgreSQLç”¨ã®æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã•ã‚Œã¾ã™\n');

console.log('ğŸ’¡ æ—¢å­˜ã®SQLiteãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸ:');
console.log(`   ${backupDir}\n`);

